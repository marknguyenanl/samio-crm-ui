steps:

  # 1️⃣ Install dependencies
  install_deps:
    image: node:22-alpine
    environment:
      TMPDIR: /tmp
    commands:
      - echo "Installing dependencies..."
      - npm install
      - npm run build
  # 2️⃣ Build Vue app    environment:

  # 3️⃣ Build and push container image
  build_image:
    image: quay.io/buildah/stable:latest
    privileged: true   # Needed for building/pushing images
    commands:
      - echo "Building container image with Buildah..."
      # Create a container from scratch
      - buildah bud -t harbor.anrostech.com/anros/crm-anros-frontend:latest -f ./Containerfile .
      # Login to Harbor
      - echo 'Harbor12345' | buildah login --username admin --password-stdin harbor.anrostech.com
      # Push the image to Harbor
      - buildah push harbor.anrostech.com/anros/crm-anros-frontend:latest
    depends_on:
      - install_deps
